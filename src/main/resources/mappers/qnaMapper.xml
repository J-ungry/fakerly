<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.joongbu.fakerly.mapper.QnaMapper">
	<resultMap type="QnaDto" id="QnaMap">
		<id column="qa_no" property="qaNo"/>
		<result column="title" property="title"/>	
		<result column="contents" property="contents"/>	
		<result column="code" property="code"/>	
		<result column="q_datetime" property="qaTime"/>		
		<result column="views" property="views"/>
		<result column="qa_resolve" property="qa_resolve"/>	
		<result column="likes" property="likes"/>
		<association property="user" foreignColumn="user_no">
  		<id column="user_no" property="user_no"/> 
  		<result column="nickname" property="nickname"/>
  		</association>
		<!-- 		<result column="user_no" property="user_no"/>	
		<result column="nickname" property="nickname"/>  -->


	</resultMap>
	<select id="qalist" resultMap="QnaMap">
		select * ,
		(SELECT COUNT(*) FROM qna_like l where l.qa_no=q.qa_no) likes
		FROM qna q
		LEFT JOIN user using(user_no)

		
	</select>

	
	<select id="qadetail" resultMap="QnaMap">
		select * ,
		(SELECT COUNT(*) FROM qna_like l where l.qa_no=q.qa_no) likes
		FROM qna q
		LEFT JOIN user using(user_no)
		WHERE qa_no=#{qaNo}
	</select>

	
	
	<insert id="insert" parameterType="QnaDto"
	useGeneratedKeys="true" keyProperty="qaNo">
		INSERT INTO QNA
			(title, contents, code, qa_resolve, user_no)
			VALUES
			(#{title},#{contents},#{code},#{qa_resolve},#{user_no})	
	</insert>  
	<update id="update" parameterType="QnaDto">
		UPDATE QNA SET
			title=#{title},
			contents=#{contents},
			code=#{code},
			qa_resolve=#{qa_resolve}
			WHERE qa_no=#{qaNo}
	</update>
	<delete id="delete">
		DELETE FROM QNA
			WHERE qa_no=#{qaNo}
	</delete>
  </mapper>